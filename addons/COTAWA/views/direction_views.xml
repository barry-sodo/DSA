<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <record id="view_direction_tree" model="ir.ui.view">
    <field name="name">direction.direction.tree</field>
    <field name="model">direction.direction</field>
    <field name="arch" type="xml">
      <list string="Directions">
        <field name="name"/>
      </list>
    </field>
  </record>
  <record id="view_direction_form" model="ir.ui.view">
    <field name="name">direction.direction.form</field>
    <field name="model">direction.direction</field>
    <field name="arch" type="xml">
      <form string="Direction">
        <sheet>
          <group>
            <field name="name"/>
            <field name="description"/>
          </group>
          <group class="section-tache-bg" colspan="2">
            <notebook>
              <page string="Agents rattachés">
                <field name="personnel_ids">
                  <list>
                    <field name="matricule"/>
                    <field name="name"/>
                    <field name="prenom"/>
                  </list>
                </field>
              </page>
            </notebook>
          </group>
        </sheet>
      </form>
    </field>
  </record>
    <record id="action_personnel_from_direction" model="ir.actions.act_window">
        <field name="name">Agents</field>
        <field name="res_model">personnel.personnel</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('direction_id', '=', context.get('search_default_direction_id'))]</field>
    </record>
    <record id="view_direction_kanban" model="ir.ui.view">
        <field name="name">direction.direction.kanban</field>
        <field name="model">direction.direction</field>
        <field name="arch" type="xml">
            <kanban>
                <field name="name"/>
                <field name="personnel_ids"/>

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click o_kanban_record"
                             style="padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); background: #fff; min-height: 120px; position: relative;">
                            <div style="font-weight: bold; font-size: 16px; color: #333; position: absolute; top: 8px; left: 8px;">
                                <t t-esc="record.name.value"/>
                            </div>
                            <div style="position: absolute; bottom: 8px; right: 8px;">
                                <a type="action" name="%(action_personnel_from_direction)d"
   context="{'default_direction_id': id, 'search_default_direction_id': id}"
   style="text-decoration: none; font-size: 14px; color: #007bff;">
    Agents
</a>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
  <record id="action_direction" model="ir.actions.act_window">
    <field name="name">Directions</field>
    <field name="res_model">direction.direction</field>
    <field name="view_mode">list,kanban,form</field>
  </record>

  <menuitem id="menu_root_direction" name="Direction" sequence="10"/>
  <menuitem id="menu_direction" name="Gérer les directions" parent="menu_root_direction" action="action_direction" sequence="20"/>
</odoo>
